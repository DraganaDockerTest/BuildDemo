queue:
  name: DemoPool
  demands: 
    - DotNetFramework
    - msbuild
    - visualstudio
    - vstest


steps:
- task: PowerShell@1
  inputs:
    scriptType: "inlineScript"
    inlineScript: "get-childitem -path env:* "

- task: NuGetToolInstaller@0

- task: NuGetCommand@2
  inputs:
    restoreSolution: "$(Parameters.solution)"

- task: qetza.replacetokens.replacetokens-task.replacetokens@2
  inputs:
    targetFiles: "**/*_layout.cshtml"
    tokenPrefix: "__"
    tokenSuffix: "__"

- task: VSBuild@1
  inputs:
    solution: "$(Parameters.solution)"
    msbuildArgs: "/p:DeployOnBuild=true /p:WebPublishMethod=Package /p:PackageAsSingleFile=true /p:SkipInvalidConfigurations=true /p:PackageLocation="$(build.artifactstagingdirectory)\\""
    platform: "$(BuildPlatform)"
    configuration: "$(BuildConfiguration)"

- task: VSTest@2
  inputs:
    testAssemblyVer2: "**\$(BuildConfiguration)\*test*.dll
!**\obj\**"
    platform: "$(BuildPlatform)"
    configuration: "$(BuildConfiguration)"

- task: PublishSymbols@1
  inputs:
    SearchPattern: "**\bin\**\*.pdb"

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: "$(build.artifactstagingdirectory)"
    ArtifactName: "$(Parameters.ArtifactName)"
    ArtifactType: "Container"
